# 方案调研

## 项目分析

- 项目本身的体积较小，构建速度优化不明显。
- 项目主要处理不同子包之间的依赖问题，相比于构建，更关注依赖关系
- 项目本身较小，最好选择轻量级方案

## 当前主流 monorepo 方案：

### 构建型：

- Turborepo：并行构建+远程缓存，提升构建效率，可配置构建顺序
- Rush：软链接解决幽灵依赖问题，并行构建支持，发布流完善且可扩展
- Nx：并行增量构建，分布式缓存。可以扩展 lerna

构建型方案的优势是在面对依赖和项目体积比较大的项目时，可以有更快的解析编译速度。但相对应的，其配置比较复杂。在小型项目中使用的成本和效果不匹配

### 轻量化方案

- lerna：解决依赖问题和手动发版复杂的问题，仅实现工作流
- yarn workspace ：利用 yarn workspace 将公共依赖进行提升，安装速度更快。项目体积更小，但不提供工程管理相关的能力
  实际上的最佳实践是，Lerna 将依赖管理交给 yarn workspace；Lerna 承担依赖发布能力
- pnpm workspace：利用 pnpm 软连接的特性，直接共享依赖并解决幽灵依赖问题，安装速度极快且磁盘利用率高。但同时不提供发布能力

## 方案选型

发布流 lerna+依赖管理 yarn workspace

使用原因：项目复杂度不高，体积小，优先选择轻量化方案；相比于 pnpm，lerna 对于流程管理和发布管理的能力更强。之后可以考虑升级为 pnpm workspace + lerna 的方案，兼容两者优点
